<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.fp.mapper.UserMapper">
	
	<!-- 정보 등록 시 해당 사업자의 테이블 생성 -->
	<select id="createUserTable" resultType="java.util.Map" parameterType="java.lang.String">
		${value}
 	</select>
 	
 	<!-- 정보 신규 등록 -->
 	<insert id="registerUser">
 		insert into user (bizNo, corpName, pw, lati, longi, corpPhoneNo, sectors)
 		values ( #{bizNo}, #{corpName}, #{pw}, #{lati}, #{longi}, #{corpPhoneNo}, #{sectors})
 	</insert>
	
	<!-- 방문객 데이터 등록 -->
	<insert id="insertData">
		insert into united_board (bizNo, name, addr, phoneNo, temp, regdate)
		values ( #{bizNo}, #{name}, #{addr}, #{phoneNo}, #{temp}, now() )
	</insert>
	
	<!-- 로그인 세션용 조회 -->
	<select id="login" resultType="org.fp.domain.UserVO">
		select * from user where bizNo = #{bizNo} and pw = #{pw}
	</select>
	
	<!-- 오늘 방문 기록 -->
	<select id="boardList" resultType="org.fp.domain.BoardVO" parameterType="org.fp.domain.UserVO">
		<![CDATA[
			select * from united_board where bizNo = #{bizNo} and regdate >= curdate()
		]]>
	</select>
	
	<!-- 이상 체온 리스트 -->
	<select id="monitorList" resultType="org.fp.domain.DashBoardVO">
		<![CDATA[
			select u.corpName, u.corpPhoneNo, b.temp, b.name, b.addr, b.phoneNo, b.regdate, u.lati, u.longi
			from user u, united_board b 
			where u.bizNo = b.bizNo and (b.temp < 35.5 or b.temp > 37.5) and b.regdate >= curdate()
		]]>
	</select>
	

</mapper>